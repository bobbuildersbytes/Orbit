<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orbit | Join the Galaxy</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://unpkg.com/cropperjs@1.6.1/dist/cropper.min.css" />
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <style>
      html, body {
          margin: 0;
          padding: 0;
          height: 100%;
          overflow: hidden;
          background: #020617;
      }
      
      /* ===== SPACE STAGE ===== */
      .space-stage {
          position: fixed;
          inset: 0;
          background: radial-gradient(circle at center, #1e293b 0%, #020617 70%);
          overflow: hidden;
          z-index: 0;
      }
      
      /* ===== STARFIELD ===== */
      .stars {
          position: absolute;
          inset: -200%;
          background-image:
              radial-gradient(2px 2px at 20px 30px, #fff, transparent),
              radial-gradient(2px 2px at 40px 70px, #fff, transparent),
              radial-gradient(2px 2px at 90px 40px, #fff, transparent),
              radial-gradient(1px 1px at 130px 80px, #fff, transparent),
              radial-gradient(1px 1px at 160px 120px, #fff, transparent);
          background-size: 200px 200px;
          animation: star-drift 120s linear infinite;
          opacity: 0.4;
      }
      
      @keyframes star-drift {
          from { transform: translateY(0); }
          to { transform: translateY(1000px); }
      }
      
      /* ===== ORBIT SYSTEM ===== */
      .orbit-system {
          position: absolute;
          top: 50%;
          left: 50%;
          width: 1px;
          height: 1px;
      }
      
      /* Orbit rings (invisible, just for motion) */
      .orbit {
          position: absolute;
          border-radius: 50%;
          border: 1px dashed rgba(255,255,255,0.05);
      }
      
      /* ===== PLANETS ===== */
      .planet {
          position: absolute;
          border-radius: 50%;
          box-shadow:
              inset -15px -15px 30px rgba(0,0,0,0.6),
              0 0 30px rgba(255,255,255,0.15);
      }
      
      /* Blue Planet */
      .orbit-blue {
          width: 600px;
          height: 600px;
          margin-left: -300px;
          margin-top: -300px;
          animation: spin 60s linear infinite;
      }
      
      .planet-blue {
          width: 140px;
          height: 140px;
          background: radial-gradient(circle at 30% 30%, #60a5fa, #1e3a8a);
          position: absolute;
          top: -70px;
          left: 50%;
          transform: translateX(-50%);
      }
      
      /* Orange Planet */
      .orbit-orange {
          width: 900px;
          height: 900px;
          margin-left: -450px;
          margin-top: -450px;
          animation: spin 120s linear infinite reverse;
      }
      
      .planet-orange {
          width: 90px;
          height: 90px;
          background: radial-gradient(circle at 30% 30%, #fb923c, #9a3412);
          position: absolute;
          top: -45px;
          left: 50%;
          transform: translateX(-50%);
      }
      
      /* Spin animation */
      @keyframes spin {
          from { transform: rotate(0deg); }
          to   { transform: rotate(360deg); }
      }
      
      /* ===== LOGIN LAYER ===== */
      #login-view {
          position: relative;
          z-index: 10;
          height: 100vh;
          display: flex;
          align-items: center;
          justify-content: center;
      }
      </style>
</head>
<body>
    <div class="space-stage">
        <div class="stars"></div>
        <div class="orbit-system">
            <div class="orbit orbit-blue"></div>
            <div class="orbit orbit-orange"></div>
        </div>
    </div>

    <div id="login-view" class="view-container">
        <div class="login-box" style="max-width: 480px">
            <h1>Join Orbit</h1>
            <div id="auth-section">
                <form
                    id="signupForm"
                    action="/signup"
                    method="POST"
                    enctype="multipart/form-data"
                    style="display: flex; flex-direction: column; gap: var(--space-3)"
                >
                    <div style="text-align: left">
                        <label
                            for="profilePicture"
                            style="
                                font-size: var(--font-size-sm);
                                color: var(--color-gray-600);
                                margin-bottom: var(--space-1);
                                display: block;
                            "
                            >Profile Picture</label
                        >
                        <input
                            type="file"
                            id="profilePicture"
                            name="profilePicture"
                            accept="image/*"
                            style="padding: var(--space-2); display: none;"
                        />
                        <input type="hidden" id="croppedImage" name="croppedImage" />
                        <button type="button" id="selectImageBtn" class="secondary" style="width: 100%; margin-bottom: var(--space-2);">Select Image</button>
                        <div id="cropContainer" style="display: none; margin-top: var(--space-2);">
                            <img id="cropImage" style="max-width: 100%; display: block;" />
                            <div style="margin-top: var(--space-2); display: flex; gap: var(--space-2);">
                                <button type="button" id="cropBtn" class="secondary" style="flex: 1;">Crop & Continue</button>
                                <button type="button" id="cancelCropBtn" class="secondary" style="flex: 1;">Cancel</button>
                            </div>
                        </div>
                        <div id="previewContainer" style="display: none; margin-top: var(--space-2); text-align: center;">
                            <img id="previewImage" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid #3b82f6;" />
                            <div style="margin-top: var(--space-2);">
                                <button type="button" id="changeImageBtn" class="secondary small">Change Image</button>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: var(--space-3)">
                        <input
                            type="text"
                            id="firstName"
                            name="firstName"
                            placeholder="First Name"
                            required
                        />
                        <input
                            type="text"
                            id="lastName"
                            name="lastName"
                            placeholder="Last Name"
                            required
                        />
                    </div>
                    <input
                        type="email"
                        id="email"
                        name="email"
                        placeholder="Email Address"
                        required
                    />
                    <input
                        type="password"
                        id="password"
                        name="password"
                        placeholder="Password"
                        required
                    />

                    <button
                        type="submit"
                        style="width: 100%; margin-top: var(--space-2)"
                    >
                        Sign Up
                    </button>
                </form>

                <div class="divider">Already have an account?</div>

                <a href="/" style="text-decoration: none">
                    <button class="secondary" style="width: 100%">Back to Login</button>
                </a>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/cropperjs@1.6.1/dist/cropper.min.js"></script>
    <script>
        let cropper = null;
        const profilePictureInput = document.getElementById('profilePicture');
        const selectImageBtn = document.getElementById('selectImageBtn');
        const cropContainer = document.getElementById('cropContainer');
        const cropImage = document.getElementById('cropImage');
        const cropBtn = document.getElementById('cropBtn');
        const cancelCropBtn = document.getElementById('cancelCropBtn');
        const previewContainer = document.getElementById('previewContainer');
        const previewImage = document.getElementById('previewImage');
        const changeImageBtn = document.getElementById('changeImageBtn');
        const croppedImageInput = document.getElementById('croppedImage');
        const signupForm = document.getElementById('signupForm');

        selectImageBtn.addEventListener('click', () => {
            profilePictureInput.click();
        });

        changeImageBtn.addEventListener('click', () => {
            previewContainer.style.display = 'none';
            croppedImageInput.value = '';
            profilePictureInput.value = '';
            selectImageBtn.style.display = 'block';
        });

        profilePictureInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    cropImage.src = event.target.result;
                    cropContainer.style.display = 'block';
                    previewContainer.style.display = 'none';
                    selectImageBtn.style.display = 'none';
                    
                    if (cropper) {
                        cropper.destroy();
                    }
                    
                    cropper = new Cropper(cropImage, {
                        aspectRatio: 1,
                        viewMode: 1,
                        autoCropArea: 1,
                        responsive: true,
                        background: false,
                    });
                };
                reader.readAsDataURL(file);
            }
        });

        cropBtn.addEventListener('click', () => {
            if (cropper) {
                const canvas = cropper.getCroppedCanvas({
                    width: 400,
                    height: 400,
                });
                
                canvas.toBlob((blob) => {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        croppedImageInput.value = reader.result;
                        previewImage.src = reader.result;
                        cropContainer.style.display = 'none';
                        previewContainer.style.display = 'block';
                        if (cropper) {
                            cropper.destroy();
                            cropper = null;
                        }
                    };
                    reader.readAsDataURL(blob);
                });
            }
        });

        cancelCropBtn.addEventListener('click', () => {
            cropContainer.style.display = 'none';
            selectImageBtn.style.display = 'block';
            profilePictureInput.value = '';
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }
        });

        // Form submission
        signupForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(signupForm);
            fetch('/signup', {
                method: 'POST',
                body: formData
            })
            .then(res => {
                if (res.ok) {
                    window.location.href = '/main';
                } else {
                    alert('Signup failed. Please try again.');
                }
            })
            .catch(err => {
                console.error('Signup error:', err);
                alert('Error during signup: ' + err.message);
            });
        });
    </script>
</body>
